{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}UCMAS{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'tabler/css/tabler.min.css' %}">
    <link rel="stylesheet" href="{% static 'tabler/css/tabler-vendors.min.css' %}">

    <style>
      /* Sidebar brand block */
      /* ✅ FIX: keep sidebar fixed, prevent it from stealing width */
.navbar-vertical{
  flex: 0 0 260px;     /* fixed sidebar width */
  width: 260px;
  min-width: 260px;
}
/* ✅ FIX: main content must take the remaining space */
.page-wrapper{
  flex: 1 1 auto;
  min-width: 0;        /* VERY IMPORTANT for flex layouts */
}
/* optional: prevent container from looking too narrow */
.page-body .container-xl{
  max-width: 1400px;   /* or remove if you want default */
}


      .sidebar-brand {
        display: flex;
        align-items: center;
        gap: .75rem;
        text-decoration: none;
        color: inherit;
      }
      .sidebar-brand:hover { text-decoration: none; }

      .sidebar-logo {
        height: 44px;
        width: 44px;
        object-fit: contain;
        background: #fff;
        border-radius: 10px;
        padding: 6px;
      }

      .sidebar-title {
        font-weight: 700;
        letter-spacing: .2px;
        line-height: 1.1;
      }
      .sidebar-subtitle {
        font-size: 12px;
        opacity: .75;
        line-height: 1.1;
      }

      /* Make sidebar full height + push logout to bottom */
      .sidebar-flex {
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: calc(100vh - 1rem);
      }
      .sidebar-nav {
        flex: 1 1 auto;
      }
      .sidebar-bottom {
        margin-top: auto;
        padding-top: 1rem;
        border-top: 1px solid rgba(255,255,255,.12);
      }

      /* Logout button style */
      .logout-btn {
        width: 100%;
        text-align: left;
        padding: .5rem .75rem;
        border-radius: .5rem;
      }
      .logout-btn:hover {
        background: rgba(220, 53, 69, .12);
      }
    </style>
  </head>

  <body>
    <div class="page d-flex">
      <!-- Sidebar -->
      <aside class="navbar navbar-vertical navbar-expand-lg" data-bs-theme="dark">
        <div class="container-fluid sidebar-flex">

          <!-- Brand -->
          <h1 class="navbar-brand navbar-brand-autodark mb-2">
            <a class="sidebar-brand" href="{% url 'portal_dashboard' %}">
              {# Use the correct file extension you have on Render: logo.jpeg #}
              <img src="{% static 'brand/ucmas_logo.jpeg' %}" alt="Arabic Square" class="sidebar-logo">
              <div>
                <div class="sidebar-title">UCMAS KSA</div>
                <div class="sidebar-subtitle">School / Association Portal</div>
              </div>
            </a>
          </h1>

          <!-- Mobile menu toggle -->
          <div class="navbar-nav flex-row d-lg-none">
            <a class="nav-link" data-bs-toggle="collapse" data-bs-target="#sidebar-menu" aria-expanded="false">
              Menu
            </a>
          </div>

          <div class="collapse navbar-collapse sidebar-nav" id="sidebar-menu">
            <ul class="navbar-nav pt-lg-3">

              <li class="nav-item">
                <a class="nav-link" href="{% url 'portal_dashboard' %}">
                  <span class="nav-link-title">Dashboard</span>
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="{% url 'portal_student_list' %}">
                  <span class="nav-link-title">Students</span>
                </a>
              </li>

             

              {# ✅ Removed Add Student from sidebar to keep UI clean and rely on dashboard header button #}

            </ul>
          </div>

          <!-- Bottom Logout -->
          <div class="sidebar-bottom">
            <ul class="navbar-nav">
              <li class="nav-item">
                <form method="post" action="{% url 'portal_logout' %}">
                  {% csrf_token %}
                  <button type="submit"
                    class="nav-link text-danger w-100 text-start border-0 bg-transparent logout-btn">
                    <span class="nav-link-title">Logout</span>
                  </button>
                </form>
              </li>
            </ul>
          </div>

        </div>
      </aside>

      <!-- Main -->
      <div class="page-wrapper flex-fill">

        <!-- Topbar -->
        <header class="navbar navbar-expand-md navbar-light d-none d-lg-flex">
          <div class="container-xl"style="padding-left: 25px;"">
            <div class="navbar-nav flex-row order-md-last">
              <div class="nav-item dropdown">
                <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown" aria-label="Open user menu">
                  <div class="d-none d-xl-block ps-2">
                    <div>{{ request.user.username }}</div>
                    <div class="mt-1 small text-muted">
                      {{ request.user.get_role_display }}
                      {% if request.user.organization %} · {{ request.user.organization.name_en }}{% endif %}
                    </div>
                  </div>
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                  <form method="post" action="{% url 'portal_logout' %}" class="px-2 py-1">
                    {% csrf_token %}
                    <button type="submit" class="dropdown-item">Logout</button>
                  </form>
                </div>
              </div>
            </div>

            <div class="navbar-nav">
              <div class="nav-item">
                <span class="nav-link disabled">
                  School / Association Portal
                </span>
              </div>
            </div>
          </div>
        </header>

        <!-- Page Content -->
        <div class="page-body">
          <div class="container-xl">
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }} mt-3">{{ message }}</div>
              {% endfor %}
            {% endif %}

            {% block content %}{% endblock %}
          </div>
        </div>

        <footer class="footer footer-transparent d-print-none">
          <div class="container-xl">
            <div class="text-center text-muted py-2">
              UCMAS KSA Portal
            </div>
          </div>
        </footer>

      </div>
    </div>

    <script src="{% static 'tabler/js/tabler.min.js' %}"></script>
  </body>
</html>
