{% extends "portal/layout.html" %}
{% block title %}Dashboard | UCMAS{% endblock %}

{% block content %}
<div class="page-header d-print-none mb-4">
  <div class="row align-items-center g-2">
    <div class="col">
      <h2 class="page-title mb-1">Dashboard</h2>
      <div class="text-muted mt-1">
        Welcome, {{ request.user.username }}{% if org_name %} · {{ org_name }}{% endif %}
      </div>
    </div>
  </div>
</div>

<style>
  /* MODULES = FULL COLOR, SAME HEIGHT */
  .module-card{
    border-radius: 14px;
    min-height: 160px;
    border: 1px solid rgba(0,0,0,.06);
    display:block;
  }
  .module-card .card-body{ padding: 22px; }
  .module-pill{
    display:inline-block;
    padding: .28rem .65rem;
    border-radius: 999px;
    font-weight: 700;
    font-size: .75rem;
    letter-spacing: .03em;
    background: rgba(255,255,255,.6);
  }

  /* Logo colors (soft background) */
  .module-green  { background: rgba(47,179,68,.18); }
  .module-yellow { background: rgba(245,159,0,.18); }
  .module-blue   { background: rgba(32,107,196,.16); }

  /* Hover */
  .module-card:hover{
    transform: translateY(-1px);
    transition: .12s ease;
  }
</style>

<div class="row row-deck row-cards">

  {# =======================
     1) MODULES (TOP ROW)
     ======================= #}
  <div class="col-12">
    <div class="row g-3">

      <div class="col-12 col-md-4">
        <a href="{% url 'portal_student_add' %}" class="card module-card module-green text-decoration-none">
          <div class="card-body">
            <span class="module-pill">MODULE</span>
            <h3 class="mt-3 mb-1">Register New Student</h3>
            <div class="text-muted">Add a student to your school database.</div>
          </div>
        </a>
      </div>

      <div class="col-12 col-md-4">
        <a href="{% url 'portal_course_register' %}" class="card module-card module-yellow text-decoration-none">
          <div class="card-body">
            <span class="module-pill">MODULE</span>
            <h3 class="mt-3 mb-1">Register in a Course</h3>
            <div class="text-muted">Select a course then enroll eligible students.</div>
          </div>
        </a>
      </div>

      <div class="col-12 col-md-4">
        <a href="{% url 'portal_competition_register' %}" class="card module-card module-blue text-decoration-none">
          <div class="card-body">
            <span class="module-pill">MODULE</span>
            <h3 class="mt-3 mb-1">Register in a Competition</h3>
            <div class="text-muted">Select students and add them to a competition.</div>
          </div>
        </a>
      </div>

    </div>
  </div>

  {# ✅ Recent Students #}
  <div class="col-12 mt-3">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Recent Students</h3>
        <div class="card-actions">
          <a href="{% url 'portal_student_list' %}" class="btn btn-outline-primary btn-sm">
            View all
          </a>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-vcenter card-table">
          <thead>
            <tr>
              <th>Registration No</th>
              <th>Student</th>
              <th>Level</th>
              <th class="w-1"></th>
            </tr>
          </thead>
          <tbody>
            {% for s in recent_students %}
              <tr>
                <td class="text-muted">{{ s.sa_registration_no }}</td>
                <td class="fw-semibold">{{ s.first_name_en }} {{ s.last_name_en }}</td>
                <td><span class="badge bg-blue-lt">Level {{ s.current_level }}</span></td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-primary" href="{% url 'portal_student_edit' s.pk %}">
                    Edit
                  </a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" class="text-center text-muted py-4">
                  No students yet.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  {# ✅ Current Open Events #}
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Current Open Events</h3>
      </div>
      <div class="card-body">
        {% if open_events %}
          <div class="table-responsive">
            <table class="table table-vcenter">
              <thead>
                <tr>
                  <th>Code</th>
                  <th>Name</th>
                  <th>City</th>
                  <th>Deadline</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for ev in open_events %}
                <tr>
                  <td><span class="badge bg-blue-lt">{{ ev.code }}</span></td>
                  <td class="fw-semibold">{{ ev.name }}</td>
                  <td>{{ ev.city|default:"-" }}</td>
                  <td>{{ ev.deadline|default:"-" }}</td>
                  <td><span class="badge bg-green-lt">OPEN</span></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">No OPEN events currently.</div>
        {% endif %}
      </div>
    </div>
  </div>

</div>
{% endblock %}