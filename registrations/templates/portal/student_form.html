{% extends "portal/layout.html" %}
{% load static %}

{% block title %}
  {% if mode == "edit" %}Edit Student{% else %}Add Student{% endif %} | UCMAS
{% endblock %}

{% block content %}
<div class="page-header d-print-none">
  <div class="row align-items-center">
    <div class="col">
      <h2 class="page-title">
        {% if mode == "edit" %}Edit Student{% else %}Add Student{% endif %}
      </h2>
      <div class="text-muted mt-1">
        {% if mode == "edit" %}
          Update the student details. Submitted students cannot be edited.
        {% else %}
          Add a new student (saved as Draft).
        {% endif %}
      </div>
    </div>

    <div class="col-auto ms-auto d-print-none">
      <a href="{% url 'portal_student_list' %}" class="btn btn-outline-secondary">
        Back to Students
      </a>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">

    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}

      <div class="row g-3">

        <!-- Event -->
        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.event.label }}</label>
          {{ form.event }}
          {% if form.event.errors %}
            <div class="invalid-feedback d-block">{{ form.event.errors|striptags }}</div>
          {% endif %}
          <div class="form-hint">Select the event this student will register for.</div>
        </div>

        <!-- Level -->
        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.level.label }}</label>
          {{ form.level }}
          {% if form.level.errors %}
            <div class="invalid-feedback d-block">{{ form.level.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-12"><hr class="my-2"></div>

        <!-- Names EN -->
        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.first_name_en.label }}</label>
          {{ form.first_name_en }}
          {% if form.first_name_en.errors %}
            <div class="invalid-feedback d-block">{{ form.first_name_en.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.last_name_en.label }}</label>
          {{ form.last_name_en }}
          {% if form.last_name_en.errors %}
            <div class="invalid-feedback d-block">{{ form.last_name_en.errors|striptags }}</div>
          {% endif %}
        </div>

        <!-- Names AR -->
        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.first_name_ar.label }}</label>
          {{ form.first_name_ar }}
          {% if form.first_name_ar.errors %}
            <div class="invalid-feedback d-block">{{ form.first_name_ar.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.last_name_ar.label }}</label>
          {{ form.last_name_ar }}
          {% if form.last_name_ar.errors %}
            <div class="invalid-feedback d-block">{{ form.last_name_ar.errors|striptags }}</div>
          {% endif %}
        </div>

        <!-- DOB + Gender -->
        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.date_of_birth.label }}</label>
          {{ form.date_of_birth }}
          {% if form.date_of_birth.errors %}
            <div class="invalid-feedback d-block">{{ form.date_of_birth.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.gender.label }}</label>
          {{ form.gender }}
          {% if form.gender.errors %}
            <div class="invalid-feedback d-block">{{ form.gender.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-12"><hr class="my-2"></div>

        <!-- Guardian -->
        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.guardian_name.label }}</label>
          {{ form.guardian_name }}
          {% if form.guardian_name.errors %}
            <div class="invalid-feedback d-block">{{ form.guardian_name.errors|striptags }}</div>
          {% endif %}
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.guardian_phone.label }}</label>
          {{ form.guardian_phone }}
          {% if form.guardian_phone.errors %}
            <div class="invalid-feedback d-block">{{ form.guardian_phone.errors|striptags }}</div>
          {% endif %}
          <div class="form-hint">Format: +9665XXXXXXXX</div>
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">{{ form.guardian_email.label }}</label>
          {{ form.guardian_email }}
          {% if form.guardian_email.errors %}
            <div class="invalid-feedback d-block">{{ form.guardian_email.errors|striptags }}</div>
          {% endif %}
        </div>

        <!-- Notes -->
        <div class="col-12">
          <label class="form-label">{{ form.notes.label }}</label>
          {{ form.notes }}
          {% if form.notes.errors %}
            <div class="invalid-feedback d-block">{{ form.notes.errors|striptags }}</div>
          {% endif %}
        </div>

      </div>

      <div class="mt-4 d-flex gap-2">
        <button class="btn btn-primary" type="submit">
          {% if mode == "edit" %}Save Changes{% else %}Save Draft{% endif %}
        </button>
        <a class="btn btn-outline-secondary" href="{% url 'portal_student_list' %}">Cancel</a>
      </div>
    </form>

  </div>
</div>
{% endblock %}
